<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailerPro | Enterprise Retail Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #0369a1;
            --primary-dark: #075985;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        
        /* Login Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        }
        
        .login-card {
            background: var(--surface);
            border-radius: 16px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }
        
        .login-header {
            padding: 2rem;
            text-align: center;
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .login-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .login-subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .login-form {
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(3, 105, 161, 0.1);
        }
        
        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(3, 105, 161, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text);
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-text {
            background: transparent;
            color: var(--text);
        }
        
        .btn-text:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .btn-loader {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Dashboard Layout */
        .app-container {
            display: none;
            min-height: 100vh;
        }
        
        .app-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-content {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }
        
        .nav-section {
            margin-bottom: 1.5rem;
        }
        
        .nav-section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-light);
            padding: 0 1.5rem 0.5rem;
            font-weight: 600;
        }
        
        .nav-items {
            display: flex;
            flex-direction: column;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .nav-item:hover {
            background: rgba(3, 105, 161, 0.05);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: rgba(3, 105, 161, 0.1);
            color: var(--primary);
            border-right: 3px solid var(--primary);
        }
        
        .nav-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }
        
        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
        }
        
        .user-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--background);
            overflow: hidden;
        }
        
        .content-header {
            padding: 1.5rem 2rem;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .territory-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(3, 105, 161, 0.1);
            border-radius: 8px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .content-wrapper {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Dashboard Styles */
        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }
        
        .stat-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-icon.primary {
            background: rgba(3, 105, 161, 0.1);
            color: var(--primary);
        }
        
        .stat-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .stat-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .stat-icon.info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-content h3 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-trend {
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .stat-trend.positive {
            color: var(--success);
        }
        
        .stat-progress {
            margin-top: 0.5rem;
        }
        
        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .actions-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .actions-section h3 {
            margin-bottom: 1rem;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .action-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .action-icon {
            font-size: 1.5rem;
        }
        
        .action-text {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .activity-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .view-all {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .activity-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-text {
            margin-bottom: 0.25rem;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        /* Form Styles */
        .form-section {
            margin-bottom: 2rem;
        }
        
        .form-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(3, 105, 161, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .checkbox-label input {
            width: auto;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }
        
        /* Table Styles */
        .table-section {
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .search-box {
            position: relative;
            flex: 1;
            max-width: 300px;
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .filter-group select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .table-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--background);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-light);
        }
        
        tr:hover {
            background: rgba(0, 0, 0, 0.02);
        }
        
        /* Reports Grid */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .report-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .report-card h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Performance Styles */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .performance-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .performance-card h3 {
            margin-bottom: 1rem;
            color: var(--text);
        }
        
        .chart-placeholder {
            height: 200px;
            background: var(--background);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .toast {
            background: var(--surface);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid var(--error);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning);
        }
        
        .toast.info {
            border-left: 4px solid var(--primary);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }
        }
        
        @media (max-width: 768px) {
            .app-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar-content {
                display: flex;
                overflow-x: auto;
                padding: 0.5rem;
            }
            
            .nav-section {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .nav-items {
                flex-direction: row;
            }
            
            .nav-item {
                flex-direction: column;
                text-align: center;
                padding: 0.75rem;
                min-width: 80px;
            }
            
            .nav-text {
                font-size: 0.75rem;
                margin-top: 0.25rem;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .login-card {
                border-radius: 12px;
            }
            
            .login-header {
                padding: 1.5rem;
            }
            
            .login-form {
                padding: 1.5rem;
            }
            
            .content-wrapper {
                padding: 1rem;
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                max-width: 100%;
            }
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0369a1">
</head>
<body>
    <!-- Login Section (Visible by default) -->
    <div id="loginSection" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                    <div class="logo-icon">RP</div>
                    <h1>RetailerPro</h1>
                </div>
                <p class="login-subtitle">Enterprise Retail Management Platform</p>
            </div>
            
            <!-- DSR/TSM Login Form -->
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="password">Password *</label>
                    <input type="password" id="password" name="password" required placeholder="Enter DSR/TSM password">
                </div>

                <div class="form-group">
                    <label for="userCluster">Territory/Cluster *</label>
                    <select id="userCluster" name="userCluster" required>
                        <option value="">Select Territory</option>
                        <option value="KASARANI">Kasarani</option>
                        <option value="MWIKI">Mwiki</option>
                        <option value="ZIMMERMAN">Zimmerman</option>
                        <option value="GITHURAI">Githurai</option>
                        <option value="RUAI">Ruai</option>
                        <option value="KAMULU">Kamulu</option>
                        <option value="THOME">Thome</option>
                        <option value="NJIRU">Njiru</option>
                        <option value="KAHAWA">Kahawa</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <span class="btn-text">Access Platform</span>
                    <span class="btn-loader" style="display: none;"></span>
                </button>
            </form>

            <!-- SIBO Agency Login Button -->
            <div style="text-align: center; margin-top: 1rem;">
                <button id="siboLoginBtn" class="btn btn-outline btn-sm">
                    <span class="btn-icon">🔐</span>
                    SIBO Agency Login
                </button>
            </div>

            <!-- SIBO Agency Login Form (Hidden by default) -->
            <form id="siboLoginForm" class="login-form" style="display: none;">
                <div class="form-group">
                    <label for="siboPassword">SIBO Password *</label>
                    <input type="password" id="siboPassword" name="siboPassword" required placeholder="Enter SIBO Agency password">
                </div>
                
                <div class="form-actions" style="display: flex; gap: 0.5rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <span class="btn-text">Login as SIBO</span>
                    </button>
                    <button type="button" id="backToMainLogin" class="btn btn-secondary">
                        Back
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- App Container (Hidden by default) -->
    <div id="appContainer" class="app-container">
        <div class="app-layout">
            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <div class="logo-icon">RP</div>
                        <h1>RetailerPro</h1>
                    </div>
                </div>

                <div class="sidebar-content">
                    <div class="nav-section">
                        <h3 class="nav-section-title">CORE</h3>
                        <div class="nav-items">
                            <a href="#dashboard" class="nav-item active" data-tab="dashboard-tab">
                                <span class="nav-icon">📊</span>
                                <span class="nav-text">Dashboard</span>
                            </a>
                            <a href="#retailers" class="nav-item" data-tab="retailers-tab">
                                <span class="nav-icon">🏪</span>
                                <span class="nav-text">Retailers</span>
                            </a>
                            <a href="#prospects" class="nav-item" data-tab="prospects-tab">
                                <span class="nav-icon">👥</span>
                                <span class="nav-text">Prospects</span>
                            </a>
                            <a href="#recruitment" class="nav-item" data-tab="recruitment-tab">
                                <span class="nav-icon">✅</span>
                                <span class="nav-text">Recruitment</span>
                            </a>
                            <a href="#servicing" class="nav-item" data-tab="servicing-tab">
                                <span class="nav-icon">🔄</span>
                                <span class="nav-text">Servicing Float</span>
                            </a>
                        </div>
                    </div>

                    <!-- Clusters Section (populated dynamically) -->
                    <div class="nav-section" id="clustersSection" style="display: none;">
                        <h3 class="nav-section-title">CLUSTERS</h3>
                        <div class="nav-items" id="clustersList">
                            <!-- cluster links inserted here -->
                        </div>
                    </div>

                    <div class="nav-section" id="managementSection" style="display: none;">
                        <h3 class="nav-section-title">MANAGEMENT</h3>
                        <div class="nav-items">
                            <a href="#performance" class="nav-item" data-tab="performance-tab">
                                <span class="nav-icon">📈</span>
                                <span class="nav-text">Performance</span>
                            </a>
                            <a href="#reports" class="nav-item" data-tab="reports-tab">
                                <span class="nav-icon">📋</span>
                                <span class="nav-text">Reports</span>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="sidebar-footer">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <span id="userAvatar">U</span>
                        </div>
                        <div class="user-info">
                            <div class="user-name" id="userName">User</div>
                            <div class="user-role" id="userRoleBadge">Role</div>
                        </div>
                    </div>
                    <button id="logoutBtn" class="btn btn-secondary btn-sm">
                        <span class="btn-icon">🚪</span>
                        Logout
                    </button>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Header -->
                <header class="content-header">
                    <div class="header-left">
                        <h1 id="pageTitle">Dashboard</h1>
                        <p id="pageSubtitle" class="page-subtitle">Performance Overview</p>
                    </div>
                    <div class="header-right">
                        <div class="header-actions">
                            <button id="installBtn" class="btn btn-outline" style="display: none;">
                                <span class="btn-icon">📱</span>
                                Install App
                            </button>
                            <div class="territory-badge" id="territoryBadge" style="display: none;">
                                <span class="badge-icon">📍</span>
                                <span id="territoryName">Territory</span>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Content Sections -->
                <div class="content-wrapper">
                    <!-- Dashboard Tab -->
                    <div id="dashboard-tab" class="tab-content active">
                        <div class="dashboard-grid">
                            <!-- Stats Cards -->
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon primary">🏪</div>
                                    <div class="stat-content">
                                        <h3>Active Retailers</h3>
                                        <div class="stat-value" id="activeRetailers">0</div>
                                        <div class="stat-trend positive">+12% this month</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon success">👥</div>
                                    <div class="stat-content">
                                        <h3>Total Prospects</h3>
                                        <div class="stat-value" id="totalProspects">0</div>
                                        <div class="stat-trend positive">+8% this week</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon warning">📈</div>
                                    <div class="stat-content">
                                        <h3>Conversion Rate</h3>
                                        <div class="stat-value" id="conversionRate">0%</div>
                                        <div class="stat-trend positive">+2.5%</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon info">🎯</div>
                                    <div class="stat-content">
                                        <h3>Target Achievement</h3>
                                        <div class="stat-value" id="targetAchievement">0%</div>
                                        <div class="stat-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="actions-section">
                                <h3>Quick Actions</h3>
                                <div class="actions-grid">
                                    <button class="action-card" onclick="showTab('retailers-tab')">
                                        <span class="action-icon">➕</span>
                                        <span class="action-text">Add Retailer</span>
                                    </button>
                                    <button class="action-card" onclick="showTab('prospects-tab')">
                                        <span class="action-icon">👥</span>
                                        <span class="action-text">Add Prospect</span>
                                    </button>
                                    <button class="action-card" onclick="showTab('recruitment-tab')">
                                        <span class="action-icon">✅</span>
                                        <span class="action-text">Add Recruitment</span>
                                    </button>
                                    <button class="action-card" onclick="showTab('servicing-tab')">
                                        <span class="action-icon">🔄</span>
                                        <span class="action-text">Add Servicing</span>
                                    </button>
                                    <button class="action-card" id="exportDataBtn">
                                        <span class="action-icon">📤</span>
                                        <span class="action-text">Export Data</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="activity-section">
                                <div class="section-header">
                                    <h3>Recent Activity</h3>
                                    <a href="#" class="view-all">View All</a>
                                </div>
                                <div class="activity-list" id="recentActivity">
                                    <div class="activity-item">
                                        <div class="activity-icon">📝</div>
                                        <div class="activity-content">
                                            <div class="activity-text">Welcome to RetailerPro! Start by adding your first retailer.</div>
                                            <div class="activity-time">Just now</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Retailers Tab -->
                    <div id="retailers-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Retailer Management</h2>
                            <button class="btn btn-primary" id="addRetailerBtn">
                                <span class="btn-icon">➕</span>
                                Add Retailer
                            </button>
                        </div>

                        <!-- Retailer Form -->
                        <div class="form-section" id="retailerFormSection" style="display: none;">
                            <form id="retailerForm" class="form-card">
                                <div class="form-header">
                                    <h3>Retailer Information</h3>
                                    <button type="button" class="btn btn-text" id="cancelRetailerBtn">Cancel</button>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="msisdn">MSISDN *</label>
                                        <input type="text" id="msisdn" name="msisdn" required 
                                               placeholder="254712345678">
                                    </div>
                                    <div class="form-group">
                                        <label for="firstName">First Name *</label>
                                        <input type="text" id="firstName" name="firstName" required 
                                               placeholder="Enter first name">
                                    </div>
                                    <div class="form-group">
                                        <label for="lastName">Last Name *</label>
                                        <input type="text" id="lastName" name="lastName" required 
                                               placeholder="Enter last name">
                                    </div>
                                    <div class="form-group">
                                        <label for="businessName">Business Name</label>
                                        <input type="text" id="businessName" name="businessName" 
                                               placeholder="Enter business name">
                                    </div>
                                    <div class="form-group">
                                        <label for="siteId">Site ID *</label>
                                        <select id="siteId" name="siteId" required>
                                            <option value="">Select Site Location</option>
                                            <!-- Locations will be populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="location">Location Name</label>
                                        <input type="text" id="location" name="location" 
                                               placeholder="Enter specific location name">
                                    </div>
                                    <div class="form-group">
                                        <label for="lines">Airtel Lines</label>
                                        <input type="number" id="lines" name="lines" 
                                               placeholder="Number of active lines" min="0" max="100">
                                    </div>
                                    <div class="form-group">
                                        <label for="visitationDate">Visitation Date *</label>
                                        <input type="date" id="visitationDate" name="visitationDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="visitationTime">Visitation Time *</label>
                                        <input type="time" id="visitationTime" name="visitationTime" required>
                                    </div>
                                    <div class="form-group dsr-field">
                                        <label for="serial1">SIM Serial 1</label>
                                        <input type="text" id="serial1" name="serial1" 
                                               placeholder="Enter SIM serial number">
                                    </div>
                                    <div class="form-group dsr-field">
                                        <label for="serial2">SIM Serial 2</label>
                                        <input type="text" id="serial2" name="serial2" 
                                               placeholder="Enter SIM serial number">
                                    </div>
                                    <div class="form-group full-width">
                                        <label>Services & Programs</label>
                                        <div class="checkbox-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="ga_lm"> GA LM
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="mtd"> MTD
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="qsso"> QSSO
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="qama"> QAMA
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="kcb_agent"> KCB AGENT
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <span class="btn-icon">💾</span>
                                        Save Retailer
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="clearRetailerForm">
                                        Clear Form
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Retailers Table -->
                        <div class="table-section">
                            <div class="table-header">
                                <div class="table-controls">
                                    <div class="search-box">
                                        <span class="search-icon">🔍</span>
                                        <input type="text" id="retailerSearch" placeholder="Search retailers...">
                                    </div>
                                    <div class="table-actions">
                                        <button class="btn btn-outline" id="exportRetailersBtn">
                                            <span class="btn-icon">📤</span>
                                            Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="retailersTable">
                                    <thead>
                                        <tr>
                                            <th>MSISDN</th>
                                            <th>Retailer Name</th>
                                            <th>Business</th>
                                            <th>Site ID</th>
                                            <th>Location</th>
                                            <th>Active Lines</th>
                                            <th>Visit Date</th>
                                            <th>Visit Time</th>
                                            <th>Services</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="retailersTableBody">
                                        <!-- Retailers data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Prospects Tab -->
                    <div id="prospects-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Prospect Management</h2>
                            <button class="btn btn-primary" id="addProspectBtn">
                                <span class="btn-icon">➕</span>
                                Add Prospect
                            </button>
                        </div>

                        <!-- Prospect Form -->
                        <div class="form-section" id="prospectFormSection" style="display: none;">
                            <form id="prospectForm" class="form-card">
                                <div class="form-header">
                                    <h3>Prospect Information</h3>
                                    <button type="button" class="btn btn-text" id="cancelProspectBtn">Cancel</button>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="prospectPhone">Phone Number *</label>
                                        <input type="text" id="prospectPhone" name="prospectPhone" required 
                                               placeholder="254712345678">
                                    </div>
                                    <div class="form-group">
                                        <label for="prospectName">Full Name *</label>
                                        <input type="text" id="prospectName" name="prospectName" required 
                                               placeholder="Enter prospect name">
                                    </div>
                                    <div class="form-group">
                                        <label for="prospectBusiness">Business Type</label>
                                        <select id="prospectBusiness" name="prospectBusiness">
                                            <option value="">Select business type</option>
                                            <option value="General Shop">General Shop</option>
                                            <option value="Supermarket">Supermarket</option>
                                            <option value="Kiosk">Kiosk</option>
                                            <option value="Pharmacy">Pharmacy</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="prospectLocation">Location *</label>
                                        <input type="text" id="prospectLocation" name="prospectLocation" required 
                                               placeholder="Enter business location">
                                    </div>
                                    <div class="form-group">
                                        <label for="visitDate">Visit Date *</label>
                                        <input type="date" id="visitDate" name="visitDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="followUpDate">Follow-up Date</label>
                                        <input type="date" id="followUpDate" name="followUpDate">
                                    </div>
                                    <div class="form-group">
                                        <label for="interestLevel">Interest Level</label>
                                        <select id="interestLevel" name="interestLevel">
                                            <option value="High">High</option>
                                            <option value="Medium" selected>Medium</option>
                                            <option value="Low">Low</option>
                                        </select>
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="prospectNotes">Notes</label>
                                        <textarea id="prospectNotes" name="prospectNotes" 
                                                  placeholder="Additional notes about the prospect..." 
                                                  rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <span class="btn-icon">💾</span>
                                        Save Prospect
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="clearProspectForm">
                                        Clear Form
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Prospects Table -->
                        <div class="table-section">
                            <div class="table-header">
                                <div class="table-controls">
                                    <div class="search-box">
                                        <span class="search-icon">🔍</span>
                                        <input type="text" id="prospectSearch" placeholder="Search prospects...">
                                    </div>
                                    <div class="filter-group">
                                        <select id="statusFilter">
                                            <option value="">All Status</option>
                                            <option value="New">New</option>
                                            <option value="Contacted">Contacted</option>
                                            <option value="Follow-up">Follow-up</option>
                                            <option value="Converted">Converted</option>
                                        </select>
                                    </div>
                                    <div class="table-actions">
                                        <button class="btn btn-outline" id="exportProspectsBtn">
                                            <span class="btn-icon">📤</span>
                                            Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="prospectsTable">
                                    <thead>
                                        <tr>
                                            <th>Phone</th>
                                            <th>Name</th>
                                            <th>Business</th>
                                            <th>Location</th>
                                            <th>Interest</th>
                                            <th>Status</th>
                                            <th>Next Action</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="prospectsTableBody">
                                        <!-- Prospects data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Recruitment Tab -->
                    <div id="recruitment-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Recruitment Status</h2>
                            <button class="btn btn-primary" id="addRecruitmentBtn">
                                <span class="btn-icon">➕</span>
                                Add Recruitment
                            </button>
                        </div>

                        <!-- Recruitment Form -->
                        <div class="form-section" id="recruitmentFormSection" style="display: none;">
                            <form id="recruitmentForm" class="form-card">
                                <div class="form-header">
                                    <h3>Recruitment Information</h3>
                                    <button type="button" class="btn btn-text" id="cancelRecruitmentBtn">Cancel</button>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="recruitmentPhone">Phone Number *</label>
                                        <input type="text" id="recruitmentPhone" name="recruitmentPhone" required 
                                               placeholder="Enter phone number">
                                    </div>
                                    <div class="form-group">
                                        <label for="recruitmentName">Full Name *</label>
                                        <input type="text" id="recruitmentName" name="recruitmentName" required 
                                               placeholder="Enter full name">
                                    </div>
                                    <div class="form-group">
                                        <label for="recruitmentBusiness">Business Type</label>
                                        <select id="recruitmentBusiness" name="recruitmentBusiness">
                                            <option value="">Select business type</option>
                                            <option value="General Shop">General Shop</option>
                                            <option value="Supermarket">Supermarket</option>
                                            <option value="Kiosk">Kiosk</option>
                                            <option value="Pharmacy">Pharmacy</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="recruitmentLocation">Location *</label>
                                        <input type="text" id="recruitmentLocation" name="recruitmentLocation" required 
                                               placeholder="Enter business location">
                                    </div>
                                    <div class="form-group">
                                        <label for="recruitmentStatus">Recruitment Status *</label>
                                        <select id="recruitmentStatus" name="recruitmentStatus" required>
                                            <option value="Yes">Yes - Recruited</option>
                                            <option value="No">No - Not Recruited</option>
                                            <option value="Pending">Pending</option>
                                            <option value="Follow-up">Follow-up Required</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="recruitmentDate">Recruitment Date</label>
                                        <input type="date" id="recruitmentDate" name="recruitmentDate">
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="recruitmentNotes">Notes</label>
                                        <textarea id="recruitmentNotes" name="recruitmentNotes" 
                                                  placeholder="Additional notes about recruitment..." 
                                                  rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <span class="btn-icon">💾</span>
                                        Save Recruitment
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="clearRecruitmentForm">
                                        Clear Form
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Recruitment Table -->
                        <div class="table-section">
                            <div class="table-header">
                                <div class="table-controls">
                                    <div class="search-box">
                                        <span class="search-icon">🔍</span>
                                        <input type="text" id="recruitmentSearch" placeholder="Search recruitment...">
                                    </div>
                                    <div class="table-actions">
                                        <button class="btn btn-outline" id="exportRecruitmentBtn">
                                            <span class="btn-icon">📤</span>
                                            Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="recruitmentTable">
                                    <thead>
                                        <tr>
                                            <th>Phone</th>
                                            <th>Name</th>
                                            <th>Business</th>
                                            <th>Location</th>
                                            <th>Status</th>
                                            <th>Recruitment Date</th>
                                            <th>Added By</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recruitmentTableBody">
                                        <!-- Recruitment data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Servicing Float Tab -->
                    <div id="servicing-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Servicing Float Management</h2>
                            <button class="btn btn-primary" id="addServicingBtn">
                                <span class="btn-icon">➕</span>
                                Add Servicing
                            </button>
                        </div>

                        <!-- Servicing Form -->
                        <div class="form-section" id="servicingFormSection" style="display: none;">
                            <form id="servicingForm" class="form-card">
                                <div class="form-header">
                                    <h3>Servicing Float Information</h3>
                                    <button type="button" class="btn btn-text" id="cancelServicingBtn">Cancel</button>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="servicingRetailer">Retailer *</label>
                                        <select id="servicingRetailer" name="servicingRetailer" required>
                                            <option value="">Select Retailer</option>
                                            <!-- Retailers will be populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="servicingType">Service Type *</label>
                                        <select id="servicingType" name="servicingType" required>
                                            <option value="">Select service type</option>
                                            <option value="Device Repair">Device Repair</option>
                                            <option value="SIM Replacement">SIM Replacement</option>
                                            <option value="Float Top-up">Float Top-up</option>
                                            <option value="Training">Training</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="servicingAmount">Amount (KES)</label>
                                        <input type="number" id="servicingAmount" name="servicingAmount" 
                                               placeholder="Enter amount if applicable" min="0" max="1000000">
                                    </div>
                                    <div class="form-group">
                                        <label for="servicingDate">Service Date *</label>
                                        <input type="date" id="servicingDate" name="servicingDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="servicingStatus">Status *</label>
                                        <select id="servicingStatus" name="servicingStatus" required>
                                            <option value="Completed">Completed</option>
                                            <option value="Pending">Pending</option>
                                            <option value="In Progress">In Progress</option>
                                            <option value="Scheduled">Scheduled</option>
                                        </select>
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="servicingDescription">Service Description</label>
                                        <textarea id="servicingDescription" name="servicingDescription" 
                                                  placeholder="Describe the service provided..." 
                                                  rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <span class="btn-icon">💾</span>
                                        Save Servicing
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="clearServicingForm">
                                        Clear Form
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Servicing Table -->
                        <div class="table-section">
                            <div class="table-header">
                                <div class="table-controls">
                                    <div class="search-box">
                                        <span class="search-icon">🔍</span>
                                        <input type="text" id="servicingSearch" placeholder="Search servicing...">
                                    </div>
                                    <div class="table-actions">
                                        <button class="btn btn-outline" id="exportServicingBtn">
                                            <span class="btn-icon">📤</span>
                                            Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table id="servicingTable">
                                    <thead>
                                        <tr>
                                            <th>Retailer</th>
                                            <th>Service Type</th>
                                            <th>Amount</th>
                                            <th>Service Date</th>
                                            <th>Status</th>
                                            <th>Description</th>
                                            <th>Added By</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="servicingTableBody">
                                        <!-- Servicing data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Tab (TSM/SIBO Only) -->
                    <div id="performance-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Team Performance Analytics</h2>
                            <div class="header-actions">
                                <select id="timeFilter">
                                    <option value="week">This Week</option>
                                    <option value="month" selected>This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                        </div>
                        <div class="performance-content" id="performanceContent">
                            <!-- Performance content will be populated here for SIBO users -->
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="reports-tab" class="tab-content">
                        <div class="section-header">
                            <h2>Reports & Analytics</h2>
                            <button class="btn btn-primary" id="generateReportBtn">
                                <span class="btn-icon">📊</span>
                                Generate Report
                            </button>
                        </div>
                        <div class="reports-content" id="reportsContent">
                            <!-- Reports content will be populated here for SIBO users -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Application state
        const app = {
            currentUser: null,
            userRole: null,
            userTerritory: null,
            isLoggedIn: false,
            viewCluster: null, // cluster currently selected for viewing by SIBO

            // Master data storage with cluster information
            masterData: {
                retailers: [],
                prospects: [],
                recruitment: [],
                servicing: []
            },

            // Sample data for all clusters
            sampleData: {
                KASARANI: {
                    retailers: [
                        {
                            msisdn: "254712345678",
                            firstName: "John",
                            lastName: "Kamau",
                            businessName: "Kamau General Store",
                            siteId: "NAIROBI_KASARANI",
                            location: "Kasarani Market",
                            lines: 3,
                            visitationDate: "2024-01-15",
                            visitationTime: "10:30",
                            serial1: "SN123456",
                            serial2: "SN789012",
                            services: ["GA LM", "MTD"],
                            status: "Active",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "KASARANI"
                        }
                    ],
                    prospects: [
                        {
                            phone: "254723456789",
                            name: "Mary Wanjiku",
                            business: "General Shop",
                            location: "Kasarani Sports View",
                            visitDate: "2024-01-20",
                            followUpDate: "2024-01-27",
                            interestLevel: "High",
                            notes: "Interested in becoming an agent",
                            status: "New",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "KASARANI"
                        }
                    ],
                    recruitment: [
                        {
                            phone: "254734567890",
                            name: "Peter Maina",
                            business: "Kiosk",
                            location: "Kasarani Mwiki",
                            status: "Yes",
                            recruitmentDate: "2024-01-18",
                            notes: "Successfully recruited",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "KASARANI"
                        }
                    ],
                    servicing: [
                        {
                            retailer: "Kamau General Store",
                            serviceType: "Float Top-up",
                            amount: 5000,
                            serviceDate: "2024-01-16",
                            status: "Completed",
                            description: "Regular float top-up",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "KASARANI"
                        }
                    ]
                },
                MWIKI: {
                    retailers: [
                        {
                            msisdn: "254745678901",
                            firstName: "Sarah",
                            lastName: "Njeri",
                            businessName: "Mwiki Supermarket",
                            siteId: "NAIROBI_MWIKI",
                            location: "Mwiki Shopping Center",
                            lines: 5,
                            visitationDate: "2024-01-14",
                            visitationTime: "14:00",
                            serial1: "SN345678",
                            serial2: "SN901234",
                            services: ["QSSO", "QAMA"],
                            status: "Active",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "MWIKI"
                        }
                    ],
                    prospects: [
                        {
                            phone: "254756789012",
                            name: "David Ochieng",
                            business: "Supermarket",
                            location: "Mwiki Secondary",
                            visitDate: "2024-01-19",
                            followUpDate: "2024-01-26",
                            interestLevel: "Medium",
                            notes: "Considering agency partnership",
                            status: "Contacted",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "MWIKI"
                        }
                    ],
                    recruitment: [
                        {
                            phone: "254767890123",
                            name: "Grace Akinyi",
                            business: "Pharmacy",
                            location: "Mwiki Aberdares",
                            status: "Pending",
                            recruitmentDate: "2024-01-17",
                            notes: "Follow up required",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "MWIKI"
                        }
                    ],
                    servicing: [
                        {
                            retailer: "Mwiki Supermarket",
                            serviceType: "Device Repair",
                            amount: 1500,
                            serviceDate: "2024-01-13",
                            status: "Completed",
                            description: "Fixed card reader",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "MWIKI"
                        }
                    ]
                },
                ZIMMERMAN: {
                    retailers: [
                        {
                            msisdn: "254778901234",
                            firstName: "Michael",
                            lastName: "Kipchoge",
                            businessName: "Zimmart",
                            siteId: "NAIROBI_ZIMMERMAN",
                            location: "Zimmerman Base",
                            lines: 4,
                            visitationDate: "2024-01-16",
                            visitationTime: "11:00",
                            serial1: "SN567890",
                            serial2: "SN123456",
                            services: ["KCB AGENT", "MTD"],
                            status: "Active",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "ZIMMERMAN"
                        }
                    ],
                    prospects: [
                        {
                            phone: "254789012345",
                            name: "Lucy Wambui",
                            business: "General Shop",
                            location: "Zimmerman Mirema",
                            visitDate: "2024-01-21",
                            followUpDate: "2024-01-28",
                            interestLevel: "High",
                            notes: "Very interested in partnership",
                            status: "New",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "ZIMMERMAN"
                        }
                    ],
                    recruitment: [
                        {
                            phone: "254790123456",
                            name: "James Mutiso",
                            business: "Kiosk",
                            location: "Zimmerman Base Atlas",
                            status: "Yes",
                            recruitmentDate: "2024-01-15",
                            notes: "New agent onboarded",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "ZIMMERMAN"
                        }
                    ],
                    servicing: [
                        {
                            retailer: "Zimmart",
                            serviceType: "Training",
                            amount: 0,
                            serviceDate: "2024-01-12",
                            status: "Completed",
                            description: "Agent training session",
                            addedBy: "DSR Agent",
                            addedDate: new Date().toISOString(),
                            cluster: "ZIMMERMAN"
                        }
                    ]
                }
            },

            locations: [
                "NAIROBI_KAYOLE_JUAKALI", "NAIROBI_USIU", "NAIROBI_MIREMA_TREAT", "NAIROBI_KASARANI_SPORTS_VIEW",
                "NAIROBI_ST.FRANCIS_HOSPITAL", "NAIROBI_ATHI_MARKET", "NAIROBI_MIREMA_DRIVE", "NAIROBI_RUAI_PCEA",
                "KAMULU", "NAIROBI_GITHURAI_44", "NAIROBI_ZIMMERMAN_BASE", "NAIROBI_KASARANI_MWIKI", "NAIROBI_MUTHAIGA",
                "NAIROBI_RUAI_MAKONGENI", "NAIROBI_KAHAWA_WEST_ADC", "NAIROBI_MWENGENYE_CHEMICHEMI", "NAIROBI_ZIMMERMAN_MIREMA_HEIGHTS",
                "NAIROBI_WINDSOR_ESTATE", "NAIROBI_KAYOLE_SAIKA", "NAIROBI_KAHAWA_WEST", "NAIROBI_KAHAWA_WEST_NEW",
                "NAIROBI_RURII_GITHURAI_44", "NAIROBI_BURUBURU_FARM_NJIRU", "NAIROBI_KAHAWA_WEST_1", "NAIROBI_GITHURAI_MARKET",
                "NAIROBI_NJIRU", "NAIROBI_PAC_UNIVERSITY_ROYSAMBU", "NAIROBI_RED_SOIL_FIFTH_STREET", "NAIROBI_DANDORA_CHIEKO",
                "NAIROBI_SAIKA_MAKONGE", "NAIROBI_LINEKA", "NAIROBI_RUAI_STAGE", "NAIROBI_SUNTON_MUGUMOINI", "NAIROBI_THOME_MUTHAIGA_NORTH",
                "NAIROBI_MWIKI_SECONDARY", "NAIROBI_NJIRU_CATHOLIC_CHURCH", "NAIROBI_PENDRO_SEC_SCHOOL_GITHURAI_44", "NAIROBI_SUNTON_GITUAMBA",
                "NAIROBI_ROY_SAMBU_1", "NAIROBI_NJIRU_MAJI_MAZURI", "NAIROBI_RUAI_POLICE_STATION", "NAIROBI_TUSKER", "NAIROBI_ZIMMERMAN",
                "NAIROBI_MWIKI", "NAIROBI_RUAI_SHOPPING_CENTER", "NAIROBI_RIDGEWAYS_WMX", "NAIROBI_KIWANJA", "NAIROBI_THIKA_RD_MALL_IBS",
                "NAIROBI_KU_TEACHING_REFFERAL", "NAIROBI_GARDEN_NEW", "NAIROBI_MWIKI_KASSMATT", "NAIROBI_THIKA_RD_CLAYWORKS",
                "NAIROBI_DANDORA_SHILANGA", "NAIROBI_KASARANI_WARREN", "NAIROBI_SOWETO", "NAIROBI_KASARANI_SPORTS_COMPLEX",
                "NAIROBI_KU_BURUNDI_DRIVE", "NAIROBI_NORTHERN_BYPASS_FOURWAYS", "NAIROBI_KAMITI_ROAD", "NAIROBI_NJIRU_CHOKAA_VIEW",
                "NAIROBI_KAHAWA_WEST_SC", "NAIROBI_KAMULU_NGUNDU", "NAIROBI_MWIKI_ABERDARES", "NAIROBI_MWIKI_MAJI_MAZURI",
                "NAIROBI_ZIMMERMAN_BASE_ATLAS", "NAIROBI_WATATU_HOUSE", "NAIROBI_KASARANI_IMPROVEMENT", "NAIROBI_ROYSAMBU_PRIMARY_ATC",
                "NAIROBI_NJIRU_QUARRY", "NAIROBI_SAFARI_PARK_THIKA_ROAD", "MUTHAIGA_COUNTRY_CLUB", "NAIROBI_RUAI_GREEN_SPRING",
                "NAIROBI_CHOKA_ESTATE_ATC", "NAIROBI_NJATHAINI_ROAD", "NAIROBI_JACARANDA_ESTATE_KAMITI", "KAMULU_STAGE_26",
                "NAIROBI_CHOKAA", "NAIROBI_SAIKA", "NAIROBI_RIDGEWAYS_NEW", "NAIROBI_KAHAWA_GARISSON", "NAIROBI_CLAY_CITY",
                "NAIROBI_RUAI_AREA", "NAIROBI_NSIS", "NAIROBI_EASTERN_BYPASS_ONYATTA", "NAIROBI_KU_STAFF_QUARTERS",
                "NAIROBI_MUTHAIGA_COUNTRY_VILLAS", "NAIROBI_KASARANI", "NAIROBI_GARDEN_CITY_IBS", "NAIROBI_KASARANI_HUNTERS",
                "NAIROBI_RUAI_BONDENI", "NAIROBI_THOME_SAFARI_PARK", "NAIROBI_KAHAWA_WEST_SAFCOM", "NAIROBI_USIU_SC",
                "NAIROBI_MURERA_KASARANI", "NAIROBI_CLARETT_THOME", "NAIROBI_SPORTS_VIEW_KASARANI", "NAIROBI_KAMULU_KASARANI_TECHNICAL",
                "NAIROBI_KENYATTA_UNIVERSITY", "NAIROBI_GARDEN_ESTATE_ROAD", "NAIROBI_KASARANI_CLAYWORKS"
            ],

            // Initialize the application
            init: function() {
                this.bindEvents();
                this.loadMasterData(); // load persisted masterData or initialize from sampleData
                this.checkAuthState();
                this.populateLocations();
                this.populateClustersList(); // populate sidebar clusters links
            },

            // Bind event listeners
            bindEvents: function() {
                // Login form submission
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // SIBO login form submission
                document.getElementById('siboLoginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSiboLogin();
                });

                // SIBO login button
                document.getElementById('siboLoginBtn').addEventListener('click', () => {
                    this.toggleSiboLogin();
                });

                // Back to main login
                document.getElementById('backToMainLogin').addEventListener('click', () => {
                    this.toggleSiboLogin();
                });

                // Logout button
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.handleLogout();
                });

                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabId = item.getAttribute('data-tab');
                        this.showTab(tabId);
                    });
                });

                // Retailer form events
                document.getElementById('addRetailerBtn').addEventListener('click', () => {
                    this.toggleForm('retailer');
                });
                document.getElementById('cancelRetailerBtn').addEventListener('click', () => {
                    this.toggleForm('retailer');
                });
                document.getElementById('retailerForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveRetailer();
                });
                document.getElementById('clearRetailerForm').addEventListener('click', () => {
                    document.getElementById('retailerForm').reset();
                });

                // Prospect form events
                document.getElementById('addProspectBtn').addEventListener('click', () => {
                    this.toggleForm('prospect');
                });
                document.getElementById('cancelProspectBtn').addEventListener('click', () => {
                    this.toggleForm('prospect');
                });
                document.getElementById('prospectForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProspect();
                });
                document.getElementById('clearProspectForm').addEventListener('click', () => {
                    document.getElementById('prospectForm').reset();
                });
                
                // Recruitment form events
                document.getElementById('addRecruitmentBtn').addEventListener('click', () => {
                    this.toggleForm('recruitment');
                });
                document.getElementById('cancelRecruitmentBtn').addEventListener('click', () => {
                    this.toggleForm('recruitment');
                });
                document.getElementById('recruitmentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveRecruitment();
                });
                document.getElementById('clearRecruitmentForm').addEventListener('click', () => {
                    document.getElementById('recruitmentForm').reset();
                });
                
                // Servicing form events
                document.getElementById('addServicingBtn').addEventListener('click', () => {
                    this.toggleForm('servicing');
                });
                document.getElementById('cancelServicingBtn').addEventListener('click', () => {
                    this.toggleForm('servicing');
                });
                document.getElementById('servicingForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveServicing();
                });
                document.getElementById('clearServicingForm').addEventListener('click', () => {
                    document.getElementById('servicingForm').reset();
                });
                
                // Export buttons
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportAllData();
                });
                document.getElementById('exportRetailersBtn').addEventListener('click', () => {
                    this.exportToCSV('retailers');
                });
                document.getElementById('exportProspectsBtn').addEventListener('click', () => {
                    this.exportToCSV('prospects');
                });
                document.getElementById('exportRecruitmentBtn').addEventListener('click', () => {
                    this.exportToCSV('recruitment');
                });
                document.getElementById('exportServicingBtn').addEventListener('click', () => {
                    this.exportToCSV('servicing');
                });
                
                // Generate report button
                document.getElementById('generateReportBtn').addEventListener('click', () => {
                    this.generatePerformanceReport();
                });
                
                // Time filter for performance
                document.getElementById('timeFilter').addEventListener('change', (e) => {
                    this.updatePerformanceData(e.target.value);
                });
            },

            // Load persisted masterData or initialize from sampleData
            loadMasterData: function() {
                try {
                    const stored = localStorage.getItem('retailerProMasterData');
                    if (stored) {
                        this.masterData = JSON.parse(stored);
                    } else {
                        // initialize from sample data
                        this.initializeMasterData();
                        this.saveMasterData();
                    }
                } catch (err) {
                    console.error('Failed to load master data', err);
                    this.initializeMasterData();
                    this.saveMasterData();
                }
            },

            // Persist master data to localStorage
            saveMasterData: function() {
                try {
                    localStorage.setItem('retailerProMasterData', JSON.stringify(this.masterData));
                } catch (err) {
                    console.error('Failed to save master data', err);
                }
            },

            // Populate clusters list in sidebar
            populateClustersList: function() {
                const clustersList = document.getElementById('clustersList');
                clustersList.innerHTML = '';

                // get clusters from sampleData keys and any existing masterData entries
                const clustersFromSample = Object.keys(this.sampleData || {});
                const clustersFromMaster = [
                    ...new Set([
                        ...this.masterData.retailers.map(r => r.cluster),
                        ...this.masterData.prospects.map(p => p.cluster),
                        ...this.masterData.recruitment.map(r => r.cluster),
                        ...this.masterData.servicing.map(s => s.cluster)
                    ].filter(Boolean))
                ];
                const clusters = Array.from(new Set([...clustersFromSample, ...clustersFromMaster])).filter(Boolean);

                clusters.forEach(cluster => {
                    const a = document.createElement('a');
                    a.href = '#';
                    a.className = 'nav-item';
                    a.textContent = cluster;
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.onClusterClick(cluster);
                    });
                    clustersList.appendChild(a);
                });
            },

            // Called when a cluster is clicked in the sidebar
            onClusterClick: function(cluster) {
                if (this.userRole !== 'SIBO') {
                    this.showToast('Cluster-level views are available to SIBO only', 'warning');
                    return;
                }

                // set view cluster and update UI
                this.viewCluster = cluster;
                document.getElementById('territoryName').textContent = `Viewing: ${cluster}`;
                this.showToast(`Viewing data for ${cluster}`, 'info');

                // refresh views for selected cluster
                this.updateRetailersTable();
                this.updateProspectsTable();
                this.updateRecruitmentTable();
                this.updateServicingTable();

                // open reports/performance so SIBO sees analytics for the cluster
                this.showTab('performance-tab');
                this.updatePerformanceData('month');
            },

            // Initialize master data with sample data for all clusters
            initializeMasterData: function() {
                // Clear existing data
                this.masterData = {
                    retailers: [],
                    prospects: [],
                    recruitment: [],
                    servicing: []
                };

                // Load sample data for all clusters
                Object.keys(this.sampleData).forEach(cluster => {
                    const clusterData = this.sampleData[cluster];

                    // Add retailers
                    clusterData.retailers.forEach(retailer => {
                        this.masterData.retailers.push(retailer);
                    });

                    // Add prospects
                    clusterData.prospects.forEach(prospect => {
                        this.masterData.prospects.push(prospect);
                    });

                    // Add recruitment
                    clusterData.recruitment.forEach(recruitment => {
                        this.masterData.recruitment.push(recruitment);
                    });

                    // Add servicing
                    clusterData.servicing.forEach(servicing => {
                        this.masterData.servicing.push(servicing);
                    });
                });
            },

            // Get data based on user role and cluster
            getUserData: function() {
                if (!this.currentUser) return { retailers: [], prospects: [], recruitment: [], servicing: [] };

                const userCluster = this.userTerritory;
                const userRole = this.userRole;

                // SIBO can access all data by default
                if (userRole === 'SIBO') {
                    // if SIBO has selected a specific cluster view, return only that cluster's data
                    if (this.viewCluster) {
                        const cluster = this.viewCluster;
                        return {
                            retailers: this.masterData.retailers.filter(item => item.cluster === cluster),
                            prospects: this.masterData.prospects.filter(item => item.cluster === cluster),
                            recruitment: this.masterData.recruitment.filter(item => item.cluster === cluster),
                            servicing: this.masterData.servicing.filter(item => item.cluster === cluster)
                        };
                    }
                    return this.masterData;
                }

                // TSM and DSR can only access their cluster data
                const filteredData = {
                    retailers: this.masterData.retailers.filter(item => item.cluster === userCluster),
                    prospects: this.masterData.prospects.filter(item => item.cluster === userCluster),
                    recruitment: this.masterData.recruitment.filter(item => item.cluster === userCluster),
                    servicing: this.masterData.servicing.filter(item => item.cluster === userCluster)
                };

                return filteredData;
            },

            // Populate locations dropdown
            populateLocations: function() {
                const siteIdSelect = document.getElementById('siteId');
                this.locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    siteIdSelect.appendChild(option);
                });
            },

            // Check if user is already logged in
            checkAuthState: function() {
                const savedUser = localStorage.getItem('retailerProUser');
                if (savedUser) {
                    const userData = JSON.parse(savedUser);
                    this.loginUser(userData);
                }
            },

            // Handle DSR/TSM login
            handleLogin: function() {
                const password = document.getElementById('password').value;
                const territory = document.getElementById('userCluster').value;

                if (!password || !territory) {
                    this.showToast('Please fill in all required fields', 'error');
                    return;
                }

                // Show loading state
                const submitBtn = document.querySelector('#loginForm .btn-text');
                const loader = document.querySelector('#loginForm .btn-loader');
                submitBtn.style.display = 'none';
                loader.style.display = 'block';

                // Simulate API call
                setTimeout(() => {
                    // For demo purposes, accept any password
                    // Determine role based on password pattern (in real app, this would be from backend)
                    let role = 'DSR';
                    let name = 'Field Agent';

                    if (password.includes('tsm')) {
                        role = 'TSM';
                        name = 'Territory Manager';
                    } else if (password.includes('manager')) {
                        role = 'TSM';
                        name = 'Territory Manager';
                    }

                    const userData = {
                        name: name,
                        role: role,
                        territory: territory,
                        avatar: role === 'TSM' ? 'TM' : 'FA'
                    };

                    this.loginUser(userData);

                    // Reset button
                    submitBtn.style.display = 'block';
                    loader.style.display = 'none';
                }, 1500);
            },

            // Handle SIBO login
            handleSiboLogin: function() {
                const password = document.getElementById('siboPassword').value;

                if (!password) {
                    this.showToast('Please enter SIBO password', 'error');
                    return;
                }

                // Simulate API call
                setTimeout(() => {
                    // For demo purposes, accept any password
                    const userData = {
                        name: 'SIBO Administrator',
                        role: 'SIBO',
                        territory: 'All Territories',
                        avatar: 'SA'
                    };

                    this.loginUser(userData);
                }, 1500);
            },

            // Toggle between main login and SIBO login
            toggleSiboLogin: function() {
                const mainForm = document.getElementById('loginForm');
                const siboForm = document.getElementById('siboLoginForm');
                const siboBtn = document.getElementById('siboLoginBtn');

                if (mainForm.style.display !== 'none') {
                    mainForm.style.display = 'none';
                    siboForm.style.display = 'block';
                    siboBtn.style.display = 'none';
                } else {
                    mainForm.style.display = 'block';
                    siboForm.style.display = 'none';
                    siboBtn.style.display = 'block';
                }
            },

            // Login user and show dashboard
            loginUser: function(userData) {
                this.currentUser = userData;
                this.userRole = userData.role;
                this.userTerritory = userData.territory;
                this.isLoggedIn = true;
                this.viewCluster = null; // reset any previous cluster view

                // Save to localStorage
                localStorage.setItem('retailerProUser', JSON.stringify(userData));

                // Update UI
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userRoleBadge').textContent = userData.role;
                document.getElementById('userAvatar').textContent = userData.avatar;
                document.getElementById('territoryName').textContent = userData.territory;

                // Show management section for TSM/SIBO users
                if (userData.role === 'TSM' || userData.role === 'SIBO') {
                    document.getElementById('managementSection').style.display = 'block';
                }

                // Show clusters section only for SIBO
                if (userData.role === 'SIBO') {
                    document.getElementById('clustersSection').style.display = 'block';
                    this.populateClustersList();
                } else {
                    document.getElementById('clustersSection').style.display = 'none';
                }

                // Show territory badge
                document.getElementById('territoryBadge').style.display = 'flex';

                // Switch to app view
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';

                this.showToast(`Welcome back, ${userData.name}! Accessing ${userData.territory} cluster`, 'success');

                // Initialize dashboard data based on user role and cluster
                this.updateDashboardStats();
                this.updateRetailersTable();
                this.updateProspectsTable();
                this.updateRecruitmentTable();
                this.updateServicingTable();
                this.populateRetailerDropdown();

                // Initialize SIBO-specific features
                if (userData.role === 'SIBO') {
                    this.initializeSIBOFeatures();
                }
            },

            // Initialize SIBO-specific features
            initializeSIBOFeatures: function() {
                this.updatePerformanceData('month');
                this.initializeReports();
            },

            // Handle logout
            handleLogout: function() {
                this.currentUser = null;
                this.userRole = null;
                this.userTerritory = null;
                this.isLoggedIn = false;
                this.viewCluster = null;

                // Clear localStorage (keep masterData persisted so data does not disappear)
                localStorage.removeItem('retailerProUser');

                // Reset forms
                document.getElementById('loginForm').reset();
                document.getElementById('siboLoginForm').reset();

                // Hide management section
                document.getElementById('managementSection').style.display = 'none';
                document.getElementById('clustersSection').style.display = 'none';

                // Hide territory badge
                document.getElementById('territoryBadge').style.display = 'none';

                // Switch to login view
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('loginSection').style.display = 'flex';

                // Reset SIBO login view if active
                this.toggleSiboLogin();

                this.showToast('You have been logged out', 'info');
            },

            // Show specific tab
            showTab: function(tabId) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Remove active class from all nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Show selected tab
                const el = document.getElementById(tabId);
                if (el) el.classList.add('active');
                
                // Activate corresponding nav item
                const navItem = document.querySelector(`.nav-item[data-tab="${tabId}"]`);
                if (navItem) navItem.classList.add('active');
                
                // Update page title
                const tabTitles = {
                    'dashboard-tab': 'Dashboard',
                    'retailers-tab': 'Retailers',
                    'prospects-tab': 'Prospects',
                    'recruitment-tab': 'Recruitment',
                    'servicing-tab': 'Servicing Float',
                    'performance-tab': 'Performance',
                    'reports-tab': 'Reports'
                };
                
                document.getElementById('pageTitle').textContent = tabTitles[tabId] || 'Dashboard';
                
                // Initialize SIBO features if user is SIBO and viewing performance/reports
                if (this.userRole === 'SIBO') {
                    if (tabId === 'performance-tab') {
                        this.updatePerformanceData('month');
                    } else if (tabId === 'reports-tab') {
                        this.initializeReports();
                    }
                }
            },
            
            // Toggle form visibility
            toggleForm: function(formType) {
                const formSection = document.getElementById(`${formType}FormSection`);
                if (formSection.style.display === 'none') {
                    formSection.style.display = 'block';
                } else {
                    formSection.style.display = 'none';
                }
            },
            
            // Save retailer data
            saveRetailer: function() {
                const formData = new FormData(document.getElementById('retailerForm'));
                const retailer = Object.fromEntries(formData);

                // Get checked services
                const services = [];
                document.querySelectorAll('#retailerForm input[type="checkbox"]:checked').forEach(checkbox => {
                    services.push(checkbox.name);
                });
                retailer.services = services;

                // Add metadata
                retailer.addedBy = this.currentUser.name;
                retailer.addedDate = new Date().toISOString();
                retailer.status = 'Active';

                // If SIBO and viewing a specific cluster, assign to viewCluster, else assign user's territory
                if (this.userRole === 'SIBO' && this.viewCluster) {
                    retailer.cluster = this.viewCluster;
                } else {
                    retailer.cluster = this.userTerritory;
                }

                // Add to master data
                this.masterData.retailers.push(retailer);

                // Persist master data
                this.saveMasterData();

                // Show success message
                this.showToast('Retailer saved successfully!', 'success');

                // Hide form
                this.toggleForm('retailer');

                // Reset form
                document.getElementById('retailerForm').reset();

                // Update tables
                this.updateRetailersTable();
                this.updateDashboardStats();
                this.populateRetailerDropdown();
                this.populateClustersList();
            },

            // Save prospect data
            saveProspect: function() {
                const formData = new FormData(document.getElementById('prospectForm'));
                const prospect = Object.fromEntries(formData);

                // Add metadata
                prospect.addedBy = this.currentUser.name;
                prospect.addedDate = new Date().toISOString();
                prospect.status = 'New';

                if (this.userRole === 'SIBO' && this.viewCluster) {
                    prospect.cluster = this.viewCluster;
                } else {
                    prospect.cluster = this.userTerritory;
                }

                // Add to master data
                this.masterData.prospects.push(prospect);

                // Persist master data
                this.saveMasterData();

                // Show success message
                this.showToast('Prospect saved successfully!', 'success');

                // Hide form
                this.toggleForm('prospect');

                // Reset form
                document.getElementById('prospectForm').reset();

                // Update tables
                this.updateProspectsTable();
                this.updateDashboardStats();
                this.populateClustersList();
            },

            // Save recruitment data
            saveRecruitment: function() {
                const formData = new FormData(document.getElementById('recruitmentForm'));
                const recruitment = Object.fromEntries(formData);

                // Add metadata
                recruitment.addedBy = this.currentUser.name;
                recruitment.addedDate = new Date().toISOString();

                if (this.userRole === 'SIBO' && this.viewCluster) {
                    recruitment.cluster = this.viewCluster;
                } else {
                    recruitment.cluster = this.userTerritory;
                }

                // Add to master data
                this.masterData.recruitment.push(recruitment);

                // Persist master data
                this.saveMasterData();

                // Show success message
                this.showToast('Recruitment saved successfully!', 'success');

                // Hide form
                this.toggleForm('recruitment');

                // Reset form
                document.getElementById('recruitmentForm').reset();

                // Update tables
                this.updateRecruitmentTable();
                this.updateDashboardStats();
                this.populateClustersList();
            },

            // Save servicing data
            saveServicing: function() {
                const formData = new FormData(document.getElementById('servicingForm'));
                const servicing = Object.fromEntries(formData);

                // Add metadata
                servicing.addedBy = this.currentUser.name;
                servicing.addedDate = new Date().toISOString();

                if (this.userRole === 'SIBO' && this.viewCluster) {
                    servicing.cluster = this.viewCluster;
                } else {
                    servicing.cluster = this.userTerritory;
                }

                // Add to master data
                this.masterData.servicing.push(servicing);

                // Persist master data
                this.saveMasterData();

                // Show success message
                this.showToast('Servicing saved successfully!', 'success');

                // Hide form
                this.toggleForm('servicing');

                // Reset form
                document.getElementById('servicingForm').reset();

                // Update tables
                this.updateServicingTable();
                this.updateDashboardStats();
                this.populateClustersList();
            },

            // Update retailers table
            updateRetailersTable: function() {
                const tbody = document.getElementById('retailersTableBody');
                tbody.innerHTML = '';

                const userData = this.getUserData();

                userData.retailers.forEach((retailer, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${retailer.msisdn || '-'}</td>
                        <td>${retailer.firstName || '-'} ${retailer.lastName || ''}</td>
                        <td>${retailer.businessName || '-'}</td>
                        <td>${retailer.siteId || '-'}</td>
                        <td>${retailer.location || '-'}</td>
                        <td>${retailer.lines || '0'}</td>
                        <td>${retailer.visitationDate || '-'}</td>
                        <td>${retailer.visitationTime || '-'}</td>
                        <td>${retailer.services ? retailer.services.join(', ') : '-'}</td>
                        <td><span class="status-badge">${retailer.status || '-'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="app.editRetailer('${retailer.cluster}', ${index})">Edit</button>
                            <button class="btn btn-sm btn-secondary" onclick="app.deleteRetailer('${retailer.cluster}', ${index})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },

            // Update prospects table
            updateProspectsTable: function() {
                const tbody = document.getElementById('prospectsTableBody');
                tbody.innerHTML = '';

                const userData = this.getUserData();

                userData.prospects.forEach((prospect, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${prospect.phone || '-'}</td>
                        <td>${prospect.name || '-'}</td>
                        <td>${prospect.business || '-'}</td>
                        <td>${prospect.location || '-'}</td>
                        <td>${prospect.interestLevel || '-'}</td>
                        <td><span class="status-badge">${prospect.status || '-'}</span></td>
                        <td>${prospect.followUpDate || 'No follow-up'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="app.editProspect('${prospect.cluster}', ${index})">Edit</button>
                            <button class="btn btn-sm btn-secondary" onclick="app.deleteProspect('${prospect.cluster}', ${index})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },

            // Update recruitment table
            updateRecruitmentTable: function() {
                const tbody = document.getElementById('recruitmentTableBody');
                tbody.innerHTML = '';

                const userData = this.getUserData();

                userData.recruitment.forEach((recruitment, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${recruitment.phone || '-'}</td>
                        <td>${recruitment.name || '-'}</td>
                        <td>${recruitment.business || '-'}</td>
                        <td>${recruitment.location || '-'}</td>
                        <td><span class="status-badge">${recruitment.status || '-'}</span></td>
                        <td>${recruitment.recruitmentDate || '-'}</td>
                        <td>${recruitment.addedBy || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="app.editRecruitment('${recruitment.cluster}', ${index})">Edit</button>
                            <button class="btn btn-sm btn-secondary" onclick="app.deleteRecruitment('${recruitment.cluster}', ${index})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },

            // Update servicing table
            updateServicingTable: function() {
                const tbody = document.getElementById('servicingTableBody');
                tbody.innerHTML = '';

                const userData = this.getUserData();

                userData.servicing.forEach((servicing, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${servicing.retailer || '-'}</td>
                        <td>${servicing.serviceType || '-'}</td>
                        <td>${servicing.amount ? 'KES ' + servicing.amount : '-'}</td>
                        <td>${servicing.serviceDate || '-'}</td>
                        <td><span class="status-badge">${servicing.status || '-'}</span></td>
                        <td>${servicing.description || '-'}</td>
                        <td>${servicing.addedBy || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="app.editServicing('${servicing.cluster}', ${index})">Edit</button>
                            <button class="btn btn-sm btn-secondary" onclick="app.deleteServicing('${servicing.cluster}', ${index})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },

            // Populate retailer dropdown for servicing form
            populateRetailerDropdown: function() {
                const select = document.getElementById('servicingRetailer');
                select.innerHTML = '<option value="">Select Retailer</option>';

                const userData = this.getUserData();

                userData.retailers.forEach(retailer => {
                    const option = document.createElement('option');
                    option.value = `${retailer.firstName || ''} ${retailer.lastName || ''} - ${retailer.businessName || 'No Business Name'}`;
                    option.textContent = `${retailer.firstName || ''} ${retailer.lastName || ''} - ${retailer.businessName || 'No Business Name'}`;
                    select.appendChild(option);
                });
            },

            // Update dashboard statistics
            updateDashboardStats: function() {
                const userData = this.getUserData();
                
                document.getElementById('activeRetailers').textContent = userData.retailers.length;
                document.getElementById('totalProspects').textContent = userData.prospects.length;
                
                // Calculate conversion rate (prospects converted to retailers)
                const convertedProspects = userData.prospects.filter(p => p.status === 'Converted').length;
                const conversionRate = userData.prospects.length > 0 ? 
                    Math.round((convertedProspects / userData.prospects.length) * 100) : 0;
                document.getElementById('conversionRate').textContent = conversionRate + '%';
                
                // Calculate target achievement (placeholder)
                const targetAchievement = Math.min(100, Math.round((userData.retailers.length / 50) * 100));
                document.getElementById('targetAchievement').textContent = targetAchievement + '%';
                document.querySelector('.progress-fill').style.width = targetAchievement + '%';
                
                // Update recent activity
                this.updateRecentActivity();
            },
            
            // Update recent activity
            updateRecentActivity: function() {
                const activityList = document.getElementById('recentActivity');
                activityList.innerHTML = '';
                
                const userData = this.getUserData();
                
                // Combine all activities and sort by date
                const allActivities = [
                    ...userData.retailers.map(r => ({
                        type: 'retailer',
                        text: `Added retailer: ${r.firstName || ''} ${r.lastName || ''}`,
                        time: new Date(r.addedDate || new Date())
                    })),
                    ...userData.prospects.map(p => ({
                        type: 'prospect',
                        text: `Added prospect: ${p.name || '-'}`,
                        time: new Date(p.addedDate || new Date())
                    })),
                    ...userData.recruitment.map(r => ({
                        type: 'recruitment',
                        text: `Updated recruitment: ${r.name || '-'} - ${r.status || '-'}`,
                        time: new Date(r.addedDate || new Date())
                    })),
                    ...userData.servicing.map(s => ({
                        type: 'servicing',
                        text: `Added servicing: ${s.serviceType || '-'} for ${s.retailer || '-'}`,
                        time: new Date(s.addedDate || new Date())
                    }))
                ];
                
                // Sort by date (newest first) and take latest 5
                allActivities.sort((a, b) => b.time - a.time);
                const recentActivities = allActivities.slice(0, 5);
                
                // Add activities to list
                recentActivities.forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    
                    const icons = {
                        retailer: '🏪',
                        prospect: '👥',
                        recruitment: '✅',
                        servicing: '🔄'
                    };
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon">${icons[activity.type]}</div>
                        <div class="activity-content">
                            <div class="activity-text">${activity.text}</div>
                            <div class="activity-time">${this.formatTimeAgo(activity.time)}</div>
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            },
            
            // Format time ago
            formatTimeAgo: function(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} minutes ago`;
                if (diffHours < 24) return `${diffHours} hours ago`;
                return `${diffDays} days ago`;
            },
            
            // ========== SIBO FEATURES ==========
            
            // Update performance data for SIBO users
            updatePerformanceData: function(timeRange) {
                if (this.userRole !== 'SIBO') {
                    document.getElementById('performanceContent').innerHTML = `
                        <div class="access-denied" style="text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">🔒</div>
                            <h3>Access Restricted</h3>
                            <p>Performance analytics are only available to SIBO Administrators.</p>
                        </div>
                    `;
                    return;
                }
                
                // Generate performance data based on time range
                const performanceData = this.generatePerformanceData(timeRange);
                
                document.getElementById('performanceContent').innerHTML = `
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h3>📈 Cluster Performance</h3>
                            <div class="chart-placeholder">
                                Performance chart for ${timeRange} period
                            </div>
                            <div style="margin-top: 1rem;">
                                <strong>Top Performing Clusters:</strong>
                                <ul style="margin-top: 0.5rem;">
                                    ${performanceData.topClusters.map(cluster => `
                                        <li>${cluster.name}: ${cluster.value} retailers</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="performance-card">
                            <h3>👥 Agent Performance</h3>
                            <div class="chart-placeholder">
                                Agent performance metrics
                            </div>
                            <div style="margin-top: 1rem;">
                                <strong>Top Agents:</strong>
                                <ul style="margin-top: 0.5rem;">
                                    ${performanceData.topAgents.map(agent => `
                                        <li>${agent.name}: ${agent.conversions} conversions</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="performance-card">
                            <h3>📊 Conversion Metrics</h3>
                            <div class="stats-grid" style="grid-template-columns: 1fr;">
                                <div class="stat-card">
                                    <div class="stat-icon primary">🏪</div>
                                    <div class="stat-content">
                                        <h3>Total Retailers</h3>
                                        <div class="stat-value">${performanceData.totalRetailers}</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon success">👥</div>
                                    <div class="stat-content">
                                        <h3>Active Prospects</h3>
                                        <div class="stat-value">${performanceData.activeProspects}</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon warning">📈</div>
                                    <div class="stat-content">
                                        <h3>Conversion Rate</h3>
                                        <div class="stat-value">${performanceData.conversionRate}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            // Generate sample performance data
            generatePerformanceData: function(timeRange) {
                const clusters = ['KASARANI', 'MWIKI', 'ZIMMERMAN', 'GITHURAI', 'RUAI'];
                const agents = ['John Doe', 'Jane Smith', 'Mike Johnson', 'Sarah Williams', 'David Brown'];
                
                // if viewCluster is set, bias the results to that cluster
                const topClusters = clusters.map(cluster => ({
                    name: cluster,
                    value: Math.floor(Math.random() * 50) + 20
                })).sort((a, b) => b.value - a.value).slice(0, 3);

                return {
                    topClusters,
                    topAgents: agents.map(agent => ({
                        name: agent,
                        conversions: Math.floor(Math.random() * 30) + 10
                    })).sort((a, b) => b.conversions - a.conversions).slice(0, 3),
                    totalRetailers: this.masterData.retailers.length,
                    activeProspects: this.masterData.prospects.filter(p => p.status !== 'Converted').length,
                    conversionRate: Math.floor((this.masterData.retailers.length / (this.masterData.prospects.length + this.masterData.retailers.length || 1)) * 100)
                };
            },
            
            // Initialize reports for SIBO users
            initializeReports: function() {
                if (this.userRole !== 'SIBO') {
                    document.getElementById('reportsContent').innerHTML = `
                        <div class="access-denied" style="text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">🔒</div>
                            <h3>Access Restricted</h3>
                            <p>Reports are only available to SIBO Administrators.</p>
                        </div>
                    `;
                    return;
                }
                
                document.getElementById('reportsContent').innerHTML = `
                    <div class="reports-grid">
                        <div class="report-card">
                            <h3>📈 Performance Report</h3>
                            <p>Comprehensive performance analytics and insights across all clusters</p>
                            <button class="btn btn-outline btn-sm" onclick="app.generatePerformanceReport()">
                                Generate Report
                            </button>
                        </div>
                        <div class="report-card">
                            <h3>🏪 Retailer Report</h3>
                            <p>Detailed retailer network analysis and distribution</p>
                            <button class="btn btn-outline btn-sm" onclick="app.exportToCSV('retailers')">
                                Export CSV
                            </button>
                        </div>
                        <div class="report-card">
                            <h3>👥 Prospect Report</h3>
                            <p>Lead conversion and prospect tracking analysis</p>
                            <button class="btn btn-outline btn-sm" onclick="app.exportToCSV('prospects')">
                                Export CSV
                            </button>
                        </div>
                        <div class="report-card">
                            <h3>✅ Recruitment Report</h3>
                            <p>Recruitment status and agent onboarding analysis</p>
                            <button class="btn btn-outline btn-sm" onclick="app.exportToCSV('recruitment')">
                                Export CSV
                            </button>
                        </div>
                        <div class="report-card">
                            <h3>🔄 Servicing Report</h3>
                            <p>Service float management and maintenance analysis</p>
                            <button class="btn btn-outline btn-sm" onclick="app.exportToCSV('servicing')">
                                Export CSV
                            </button>
                        </div>
                        <div class="report-card">
                            <h3>📋 Consolidated Report</h3>
                            <p>Complete overview with all data combined</p>
                            <button class="btn btn-outline btn-sm" onclick="app.exportAllData()">
                                Export All Data
                            </button>
                        </div>
                    </div>
                `;
            },
            
            // Generate performance report
            generatePerformanceReport: function() {
                if (this.userRole !== 'SIBO') {
                    this.showToast('Access denied. SIBO privileges required.', 'error');
                    return;
                }
                
                this.showToast('Generating comprehensive performance report...', 'info');
                // In a real application, this would generate a detailed PDF report
                setTimeout(() => {
                    this.showToast('Performance report generated successfully!', 'success');
                }, 2000);
            },
            
            // ========== CSV EXPORT FUNCTIONALITY ==========
            
            // Export all data
            exportAllData: function() {
                this.exportToCSV('all');
            },
            
            // Export specific data type to CSV
            exportToCSV: function(dataType) {
                let data = [];
                let filename = '';
                
                switch(dataType) {
                    case 'retailers':
                        data = this.getUserData().retailers;
                        filename = 'retailers.csv';
                        break;
                    case 'prospects':
                        data = this.getUserData().prospects;
                        filename = 'prospects.csv';
                        break;
                    case 'recruitment':
                        data = this.getUserData().recruitment;
                        filename = 'recruitment.csv';
                        break;
                    case 'servicing':
                        data = this.getUserData().servicing;
                        filename = 'servicing.csv';
                        break;
                    case 'all':
                        // Combine all data for SIBO users, or just user's cluster data for others
                        const userData = this.getUserData();
                        data = [
                            ...userData.retailers.map(item => ({...item, type: 'retailer'})),
                            ...userData.prospects.map(item => ({...item, type: 'prospect'})),
                            ...userData.recruitment.map(item => ({...item, type: 'recruitment'})),
                            ...userData.servicing.map(item => ({...item, type: 'servicing'}))
                        ];
                        filename = 'all_data.csv';
                        break;
                }
                
                if (data.length === 0) {
                    this.showToast('No data available to export', 'warning');
                    return;
                }
                
                // Convert data to CSV
                const csv = this.convertToCSV(data);
                
                // Create and download file
                this.downloadCSV(csv, filename);
                this.showToast(`${filename} downloaded successfully!`, 'success');
            },
            
            // Convert data to CSV format
            convertToCSV: function(data) {
                if (data.length === 0) return '';
                
                const headers = Object.keys(data[0]);
                const csvRows = [];
                
                // Add headers
                csvRows.push(headers.join(','));
                
                // Add data rows
                for (const row of data) {
                    const values = headers.map(header => {
                        const value = row[header];
                        // Handle values that might contain commas or quotes
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                            return `"${value.replace(/"/g, '""')}"`;
                        }
                        return value;
                    });
                    csvRows.push(values.join(','));
                }
                
                return csvRows.join('\n');
            },
            
            // Download CSV file
            downloadCSV: function(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', filename);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            },
            
            // Edit functions (placeholder implementations)
            editRetailer: function(cluster, index) {
                this.showToast(`Editing retailer from ${cluster} cluster...`, 'info');
            },
            
            editProspect: function(cluster, index) {
                this.showToast(`Editing prospect from ${cluster} cluster...`, 'info');
            },
            
            editRecruitment: function(cluster, index) {
                this.showToast(`Editing recruitment from ${cluster} cluster...`, 'info');
            },
            
            editServicing: function(cluster, index) {
                this.showToast(`Editing servicing from ${cluster} cluster...`, 'info');
            },
            
            // Delete functions
            deleteRetailer: function(cluster, index) {
                if (confirm('Are you sure you want to delete this retailer?')) {
                    // Find the actual index in master data by matching unique fields (msisdn)
                    const filtered = this.getUserData().retailers;
                    const item = filtered[index];
                    if (!item) return;
                    const masterIndex = this.masterData.retailers.findIndex(m => m.msisdn === item.msisdn && m.cluster === item.cluster);

                    if (masterIndex !== -1) {
                        this.masterData.retailers.splice(masterIndex, 1);
                        this.saveMasterData();
                        this.updateRetailersTable();
                        this.updateDashboardStats();
                        this.populateRetailerDropdown();
                        this.populateClustersList();
                        this.showToast('Retailer deleted successfully', 'success');
                    }
                }
            },

            deleteProspect: function(cluster, index) {
                if (confirm('Are you sure you want to delete this prospect?')) {
                    const filtered = this.getUserData().prospects;
                    const item = filtered[index];
                    if (!item) return;
                    const masterIndex = this.masterData.prospects.findIndex(m => m.phone === item.phone && m.cluster === item.cluster);

                    if (masterIndex !== -1) {
                        this.masterData.prospects.splice(masterIndex, 1);
                        this.saveMasterData();
                        this.updateProspectsTable();
                        this.updateDashboardStats();
                        this.populateClustersList();
                        this.showToast('Prospect deleted successfully', 'success');
                    }
                }
            },

            deleteRecruitment: function(cluster, index) {
                if (confirm('Are you sure you want to delete this recruitment record?')) {
                    const filtered = this.getUserData().recruitment;
                    const item = filtered[index];
                    if (!item) return;
                    const masterIndex = this.masterData.recruitment.findIndex(m => m.phone === item.phone && m.cluster === item.cluster);

                    if (masterIndex !== -1) {
                        this.masterData.recruitment.splice(masterIndex, 1);
                        this.saveMasterData();
                        this.updateRecruitmentTable();
                        this.updateDashboardStats();
                        this.populateClustersList();
                        this.showToast('Recruitment record deleted successfully', 'success');
                    }
                }
            },

            deleteServicing: function(cluster, index) {
                if (confirm('Are you sure you want to delete this servicing record?')) {
                    const filtered = this.getUserData().servicing;
                    const item = filtered[index];
                    if (!item) return;
                    const masterIndex = this.masterData.servicing.findIndex(m =>
                        m.retailer === item.retailer &&
                        m.serviceDate === item.serviceDate &&
                        m.cluster === item.cluster
                    );

                    if (masterIndex !== -1) {
                        this.masterData.servicing.splice(masterIndex, 1);
                        this.saveMasterData();
                        this.updateServicingTable();
                        this.updateDashboardStats();
                        this.populateClustersList();
                        this.showToast('Servicing record deleted successfully', 'success');
                    }
                }
            },

            // Show toast notification
            showToast: function(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                const icons = {
                    success: '✅',
                    error: '❌',
                    warning: '⚠️',
                    info: 'ℹ️'
                };

                toast.innerHTML = `
                    <span class="toast-icon">${icons[type]}</span>
                    <span class="toast-message">${message}</span>
                `;

                toastContainer.appendChild(toast);

                // Remove toast after 5 seconds
                setTimeout(() => {
                    toast.remove();
                }, 5000);
            }
        };
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        
        // Global function for showing tabs (for onclick handlers)
        function showTab(tabId) {
            app.showTab(tabId);
        }
    </script>
</body>
</html>